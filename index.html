<!DOCTYPE html>
<html>
    <head>
        <title>RMIT Lectopia Search - Index</title>
        <link rel="stylesheet" href="style.css" />
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
        <script>
            function showCourses(searchTerm) {
                $.ajax({
                    url: "data.json",
                    dataType: "json",
                    method: "GET"
                }).done(function(data) {
                    var lastUpdated = new Date(data.DateGenerated);
                    var statusText = "Data last updated: "
                        + lastUpdated.toDateString() + " "
                        + lastUpdated.getHours() + ":"
                        + lastUpdated.getMinutes();
                    $("#status").html(statusText);

                    var searchTerm = $("#searchTerm").val().toLowerCase();
                    var results = [];

                    // Clear results from previous run
                    $("#results").find("tbody").empty();

                    // Filter courses by search term
                    if (typeof searchTerm !== "undefined") {
                        for (var key in data.Courses) {
                            var course = data.Courses[key];
                            if (course["Name"].toLowerCase().indexOf(searchTerm) >= 0) {
                                results.push(course);
                            }
                        }
                    }

                    // Sort course results by name
                    results.sort(function(a, b) {
                        var nameA = a.Name.toLowerCase();
                        var nameB = b.Name.toLowerCase();

                        if (nameA === nameB) {
                            return 0;
                        }
                        else {
                            return (nameA > nameB) ? 1 : -1;
                        }
                    });

                    // List courses
                    var content = "";
                    for (var i = 0; i < results.length; i++) {
                        var timestamp = results[i].LastUpdated !== null ?
                            results[i].LastUpdated.replace("T", " ") : "N/A";

                        content += "<tr>"
                            + "<td>"
                            + "<a href=\"" + "recordings.html?id="
                                + results[i].ID + "\">"
                                + results[i].Name + "</a>"
                            + "</td>"
                            + "<td>" + timestamp + "</td>"
                            + "</tr>";
                    }
                    $("#results").find("tbody").append(content);
                });
            }

            $(document).ready(function() {
                $("#status").html("Fetching data...");
                // Display full list of courses
                showCourses();

                // Register search form's submit action
                $("#searchForm").submit(function() {
                    var searchTerm = $("#searchTerm").val();
                    showCourses(searchTerm);
                });
            });
        </script>
    </head>
    <body>
        <div id="container">
            <header>
                <h1>RMIT Lectopia Search</h1>
            </header>
            <div id="content">
                <form id="searchForm" onsubmit="return false;">
                    <label for="searchTerm">Search term:</label>
                    <input id="searchTerm" type="text" />
                    <input class="button" type="submit" value="Search" />
                </form>
                <h3>Results</h3>
                <span id="status"></span>
                <table id="results">
                    <thead>
                        <th>Name</th>
                        <th>Last Updated</th>
                    </thead>
                    <tbody>
                    </tbody>
                </table>
            </div>
            <footer>
                <p>Disclaimer: All trademarks are the property of their respective owners.</p>
                <a href="https://github.com/PakkuDon/RMITLectopiaSearch">GitHub link</a>
            </footer>
        </div>
    </body>
</html>
