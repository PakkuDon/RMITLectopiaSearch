<!DOCTYPE html>
<html>
    <head>
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <title>RMIT Lectopia Search - Index</title>
        <link rel="stylesheet" href="style.css" />
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
        <script src="js/html_utility.js"></script>
        <script src="js/pager.js"></script>
        <script src="js/course_list.js"></script>
        <script>
            var PAGE_SIZE = 75;
            var pager = new Pager();

            function showCourses(searchTerm) {
                // Clear results from previous run
                $("#results").empty();

                // Filter courses by given search term
                var results = CourseList.findCourses(searchTerm);

                // Convert course data to table rows for paging
                var rows = results.map(function(course) {
                    // Format timestamp
                    var timestamp = course.LastUpdated !== null ?
                        course.LastUpdated.replace("T", " ") : "N/A";

                    // Wrap course data in a table row element
                    return "<tr>"
                        + "<td>"
                        + HtmlUtil.link("recordings.html?id="
                                        + course.ID, course.Name)
                        + "</td>"
                        + "<td>" + timestamp + "</td>"
                        + "</tr>";

                });

                var header = "<table>"
                    + "<thead>"
                    + "<th>Name</th>"
                    + "<th>Last Updated</th>"
                    + "</thead>"
                    + "<tbody>";
                var footer = "</tbody>"
                    + "</table>"
                    + "</div>";

                // Generate HTML to display results in a paged tabular format
                var pages = pager.createPagedList(rows, header, footer, PAGE_SIZE);

                // Add generated HTML to page
                $("#results").append(pages);

                // Hide all other pages except for the first
                pager.showPage("page1");
            }

            $(document).ready(function() {
                // Load course data and
                // display full list of courses
                $("#status").html("Fetching data...");
                $.ajax({
                    url: "data.json",
                    dataType: "json",
                    method: "GET"
                }).done(function(data) {
                    var lastUpdated = new Date(data.DateGenerated);
                    var statusText = "Data last updated: "
                        + lastUpdated.toDateString() + " "
                        + lastUpdated.getHours() + ":"
                        + lastUpdated.getMinutes();

                    $("#status").html(statusText);
                    CourseList.load(data);
                    showCourses();
                });

                // Register search form's submit action
                $("#searchForm").submit(function() {
                    var searchTerm = $("#searchTerm").val().toLowerCase();
                    showCourses(searchTerm);
                });

                // Switch pages whenever any of the page buttons are clicked
                $("body").on("click", "div > .button", function(event) {
                    var pageId = $(this).attr("id");
                    pager.showPage(pageId);
                });
            });
        </script>
    </head>
    <body>
        <div id="container">
            <header>
                <h1>RMIT Lectopia Search</h1>
            </header>
            <div id="content">
                <form id="searchForm" onsubmit="return false;">
                    <label for="searchTerm">Search term:</label>
                    <input id="searchTerm" type="text" />
                    <input class="button" type="submit" value="Search" />
                </form>
                <h3>Results</h3>
                <span id="status"></span>
                <div id="results">
                </div>
            </div>
            <footer>
                <p>Disclaimer: All trademarks are the property of their respective owners.</p>
                <a href="https://github.com/PakkuDon/RMITLectopiaSearch">GitHub link</a>
            </footer>
        </div>
    </body>
</html>
